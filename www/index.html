<!DOCTYPE html>


<!DOCTYPE html>
<html>
  <head>
    <title>ForceTK Demo</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no;" />

    <link rel="stylesheet" href="libs/jquery-mobile/css/jquery.mobile-1.4.5.min.css" />
    <link rel="stylesheet" href="libs/bootstrap/css/bootstrap.css" />
    <link rel="stylesheet" href="libs/bootstrap/css/bootstrap-responsive.min.css" />
    <script type="text/javascript" src="libs/jquery-mobile/js/jquery-1.11.3.min.js" />
    <script type="text/javascript" src="libs/bootstrap/js/bootstrap.min.js" />

    <script type="text/javascript" src="libs/jquery-mobile/js/jquery.popupwindow.js" />

    <script type="text/javascript" src="libs/jquery-mobile/plugin/Popup/assets/js/jquery.popup.js" security="none" ></script>
    <script type="text/javascript" src="libs/jquery-mobile/js/jquery.mobile-1.4.5.min.js"></script> 
    <script type="text/javascript" src="libs/forcetk/forcetk.js"></script>
    <!-- <script type="text/javascript" src="libs/jquery-mobile/js/mobileapp.js"></script> -->
    
    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript">
        // OAuth Configuration
        var loginUrl    = 'https://login.salesforce.com/';
        var clientId    = '3MVG9xOCXq4ID1uEzj.xI2Cj0cOw7nD5rF7lUPaQBAZhappxMZcRsWK9ij6uCj6Bs4RjuqKrfAZMP85IRd2in';
        var redirectUri = 'mysampleapp://auth/success';         
        // var clientId    = '3MVG98SW_UPr.JFgjZIWksMdw91FKVpURBPEqCPu93pIusft.hoCBpP6QUMl9OYySrXtcqPniIZubSFWpCytZ';
        // var redirectUri = 'mysampleapp://auth/success';
        //var redirectUri = 'https://login.salesforce.com/services/oauth2/success';
        
        //var redirectUri = 'https://localhost/oauthcallback.html';
        // var redirectUri = 'https://localhost/jsapp/oauthcallback.html';
        //var proxyUrl    = 'https://localhost/jsapp/proxy.php?mode=native';


        var client = new forcetk.Client(clientId, loginUrl);

        // Make our own startsWith utility fn
        if (!String.prototype.startsWith) {
          String.prototype.startsWith = function(searchString, position) {
            position = position || 0;
            return this.lastIndexOf(searchString, position) === position;
          };
        }

        document.addEventListener("deviceready", function(){
            $('#login').click(function(e) {
                e.preventDefault();
                var ref = window.open(getAuthorizeUrl(loginUrl, clientId, redirectUri), 
                                      '_blank', 'location=no,toolbar=no');
                // alert("in");
                ref.addEventListener('loadstop', function(evt) {
                    // alert("in2");
                    if (evt.url.startsWith(redirectUri)) {
                        ref.close();
                        alert("in2");
                        sessionCallback(unescape(evt.url));
                    }
                });
            });
        });

        function getAuthorizeUrl(loginUrl, clientId, redirectUri){
            return loginUrl+'services/oauth2/authorize?display=touch'
                +'&response_type=token&client_id='+escape(clientId)
                +'&redirect_uri='+escape(redirectUri);
        }

        function sessionCallback(loc) {
            var oauthResponse = {};

            var fragment = loc.split("#")[1];

            if (fragment) {
                var nvps = fragment.split('&');
                for (var nvp in nvps) {
                    var parts = nvps[nvp].split('=');
                    oauthResponse[parts[0]] = unescape(parts[1]);
                }
            }

            if (typeof oauthResponse === 'undefined'
                || typeof oauthResponse['access_token'] === 'undefined') {
                alert("Unauthorized: No OAuth response");
            } else {
                client.setSessionToken(oauthResponse.access_token, null,
                    oauthResponse.instance_url);

                client.query("SELECT JSA_Decription__c FROM LVL1_JSA_Activity__c LIMIT 10", 
                    function(response){
                        $('#login').hide(300);
                        for (i = 0; i < response.records.length; i++) { 
                            $("<li/>").appendTo("#message ul").html("Operation: "+i+" is "+response.records[i].JSA_Decription__c);
                        }
                        // $('#message').text('The first account I see is '
                        // +response.records[0].JSA_Decription__c);
                    }
                );
            }
        }



    </script>
  </head>
<!--   <body>
    <button id="login">Click here to login</button>
    <p id="message"></p>
  </body>

  <div class-"containter">
    <div class="jumbotron">
        <button id="login">Login</button>
    </div>
    <div class="row">
        <div class="col-xs-3">
            <div id="panel1" class="panel panel-primary">
                <div id="panel1text"class="panel-heading">
                    panel1text
                </div>
                <div id="message" class="panel-body">
                </div>
            </div>
            <div id="panel2" class="panel panel-primary">
                <div id="panel2text"class="panel-heading">
                    panel1text
                </div>
                <div id="message2" class="panel-body">
                </div>
            </div>            
        </div>
    </div>
  </div>

 -->

<body>
<!-- pageone -->
<div data-role="page" id="pageone" data-theme="a">
  <div data-role="header">
    <h1>HSE Coach</h1>
  </div>

  <div data-role="main" class="ui-content">
    <p>Welcome to your HSE Coach</p>
    <!-- <a href="#">A Standard Text Link</a> -->
    <a id="login" href="#pagelanding" data-transition="slide" class="ui-btn">Login</a>


  </div>

  <div data-role="footer">
    <h1>&copy; slalom 2015</h1>
  </div>
</div> 
<!-- pageone end -->
<!-- pagelanding -->
<div data-role="page" id="pagelanding" data-theme="a">
  <div data-role="header">
    <h1>Main Page</h1>
  </div>

  <div data-role="main" class="ui-content">
    <h1>Please select an Option</h1>
    <a href="#pageJSA1" data-transition="slide" >Smart JSA</a>
    <a href="#pageSO1" data-transition="slide" >Safety Observation</a>
    <a href="#pageSI1" data-transition="slide">Safety Incident</a>
  </div>

  <div data-role="footer">
    <h1>&copy; slalom 2015</h1>
  </div>
</div> 
<!-- pagelanding end -->
<!-- pageJSA1-->
<div data-role="page" id="pageJSA1" data-theme="a">
  <div data-role="header">
    <h1>HSE Coach</h1>
  </div>

  <div data-role="main" class="ui-content">
    <p>Welcome to your HSE Coach</p>
    <!-- <a href="#">A Standard Text Link</a> -->
    <a id="login" href="#" class="ui-btn">Login</a>
    <p>Operations:</p>
    <div id="message" class="panel-body">
        <ul data-role="listview" data-autodividers="true" data-inset="true">
        </ul>
    </div>
  </div>

  <div data-role="footer">
    <h1>&copy; slalom 2015</h1>
  </div>
</div> 
<!-- pageJSA1 end-->

</body>

  <script>
  //************
    $(function() {
        $('#panel2').slideUp(1000).delay(1000).slideDown(1000);
    }); 
  //************
  </script>


</html>
